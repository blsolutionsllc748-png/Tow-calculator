<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transport Cost Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --border:#e5e7eb;
      --text:#111827;
      --muted:#6b7280;
      --dark:#0b1220;
      --success:#16a34a;
      --blue:#2563eb;
    }
    body{font-family:Arial,sans-serif;background:#f3f4f6;margin:0;padding:0;}
    .container{max-width:820px;margin:40px auto;background:#fff;border-radius:14px;padding:24px;border:1px solid var(--border);}
    h1{text-align:center;margin:0;color:var(--text);}
    .badge{font-size:12px;background:#fee2e2;color:#7f1d1d;padding:4px 10px;border-radius:999px;margin-left:6px;}
    .subtitle{text-align:center;color:var(--muted);margin:8px 0 18px;font-size:14px;}
    label{font-weight:bold;font-size:14px;margin-top:12px;display:block;}
    input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);font-size:14px;}
    .row{display:flex;gap:12px;flex-wrap:wrap;}
    .col{flex:1;min-width:240px;}
    .checkbox{display:flex;align-items:center;margin-top:10px;font-size:14px;}
    .checkbox input{margin-right:8px;}
    button{width:100%;margin-top:18px;padding:12px;background:var(--dark);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:bold;cursor:pointer;}
    #result{margin-top:16px;font-size:15px;}
    .cta{display:none;gap:10px;margin-top:14px;flex-wrap:wrap;}
    .cta a{flex:1;text-align:center;padding:11px;border-radius:12px;color:#fff;font-weight:bold;text-decoration:none;}
    .call{background:var(--success);}
    .sms{background:var(--dark);}
    .email{background:var(--blue);}
    .disclaimer{margin-top:16px;font-size:12px;color:var(--muted);}
  </style>
</head>

<body>
<div class="container">

  <h1>Transport Cost Calculator <span class="badge">Broker estimate</span></h1>
  <div class="subtitle">Nationwide auction / port transport. Final pricing confirmed before dispatch.</div>

  <div class="row">
    <div class="col">
      <label>Service type</label>
      <select id="service">
        <option value="transport">Auction / Port Transport</option>
        <option value="local">Local Tow</option>
      </select>
    </div>

    <div class="col">
      <label>Vehicle type</label>
      <select id="vehicle">
        <option value="sedan">Sedan</option>
        <option value="suv" selected>SUV / Crossover</option>
        <option value="pickup">Pickup</option>
        <option value="van">Van</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>Shipping type</label>
      <select id="shipping">
        <option value="open">Open carrier</option>
        <option value="enclosed">Enclosed carrier</option>
      </select>
    </div>

    <div class="col">
      <label>&nbsp;</label>
      <div class="checkbox">
        <input type="checkbox" id="port" />
        Port / Export handling (+$75)
      </div>
    </div>
  </div>

  <div class="checkbox">
    <input type="checkbox" id="nonrunner" />
    Vehicle is non-runner
  </div>

  <label>Pickup address</label>
  <input id="pickup" placeholder="100 Industrial Way, Conshohocken, PA 19428" />

  <label>Drop-off address</label>
  <input id="dropoff" placeholder="7364 Baltimore Annapolis Blvd, Glen Burnie, MD 21061" />

  <button id="calc">Calculate Estimate</button>

  <div id="result"></div>

  <div class="cta" id="cta">
    <a class="call" href="tel:5083692955">Call Now</a>
    <a class="sms" id="sms">Text</a>
    <a class="email" id="email">Email</a>
  </div>

  <div class="disclaimer">
    This is a non-binding estimate. Final price may vary due to carrier availability and conditions.
  </div>

</div>

<script>
/* ============================
   ðŸ”‘ API KEY (ROUTES API ONLY)
============================ */
const GOOGLE_API_KEY = "AIzaSyDw8Pr5skK_KWzofp7434NsKvnI1ENPJc8";

/* ============================
   BUSINESS RULES
============================ */
const TRANS_MIN = 200;
const PER_MILE = 1.50;
const NONRUNNER = 125;
const BROKER_FEE = 70;
const PORT_FEE = 75;

const VEHICLE_MULT = { sedan:1, suv:1.15, pickup:1.25, van:1.2 };
const SHIPPING_MULT = { open:1, enclosed:1.6 };

const ROUND_TO = 25;

/* ============================
   UTIL
============================ */
function roundPrice(n){ return Math.round(n / ROUND_TO) * ROUND_TO; }
function money(n){ return "$" + n.toFixed(2); }
function clean(a){ return a.replace(/\s+/g," ").trim(); }

const IS_ADMIN = new URLSearchParams(location.search).get("admin") === "1";

/* ============================
   ROUTES API
============================ */
async function getMiles(origin, destination){
  const res = await fetch("https://routes.googleapis.com/directions/v2:computeRoutes",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "X-Goog-Api-Key":GOOGLE_API_KEY,
      "X-Goog-FieldMask":"routes.distanceMeters"
    },
    body:JSON.stringify({
      origin:{address:origin},
      destination:{address:destination},
      travelMode:"DRIVE"
    })
  });
  const txt = await res.text();
  if(!res.ok) throw new Error(txt);
  return JSON.parse(txt).routes[0].distanceMeters / 1609.34;
}

/* ============================
   MAIN
============================ */
document.getElementById("calc").onclick = async () => {
  const pickup = clean(pickup.value);
  const dropoff = clean(dropoff.value);
  const vehicle = vehicle.value;
  const shipping = shipping.value;

  result.innerHTML = "Calculating...";
  try{
    const miles = await getMiles(pickup, dropoff);
    let total = Math.max(TRANS_MIN, miles * PER_MILE);
    if(nonrunner.checked) total += NONRUNNER;
    if(port.checked) total += PORT_FEE;

    total *= VEHICLE_MULT[vehicle] * SHIPPING_MULT[shipping];
    total += BROKER_FEE;
    const before = total;
    total = roundPrice(total);

    result.innerHTML =
      `<strong>Estimated cost: ${money(total)}</strong><br>
       Distance: ${miles.toFixed(1)} miles`;

    if(IS_ADMIN){
      result.innerHTML += `<br><small>Internal: ${money(before)}</small>`;
    }

    cta.style.display="flex";
    sms.href = "sms:5083692955?body=" + encodeURIComponent(`Quote request\nPickup: ${pickup}\nDropoff: ${dropoff}\nEstimate: ${money(total)}`);
    email.href = "mailto:info@blautoexport.com?subject=Transport Quote&body=" + encodeURIComponent(`Pickup: ${pickup}\nDropoff: ${dropoff}\nEstimate: ${money(total)}`);
  }catch(e){
    result.style.color="red";
    result.textContent="Unable to calculate distance. Please verify addresses.";
  }
};
</script>
</body>
</html>
