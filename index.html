<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transport Cost Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --bg:#f3f4f6;

      --btn:#0b1220;
      --success:#16a34a;
      --blue:#2563eb;

      --badge-bg:#fee2e2;
      --badge-text:#7f1d1d;
      --badge-border:#fecaca;

      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --radius: 14px;
    }

    * { box-sizing: border-box; }

    body{
      margin:0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .wrap{
      max-width: 920px;
      margin: 40px auto;
      padding: 0 16px;
    }

    .container{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 6px;
    }

    .logo{
      height: 40px;
      width: auto;
      display:block;
    }

    h1{
      margin:0;
      font-size: 24px;
      font-weight: 800;
      letter-spacing: .2px;
    }

    .badge{
      display:inline-block;
      margin-left: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: var(--badge-bg);
      color: var(--badge-text);
      border: 1px solid var(--badge-border);
      vertical-align: middle;
      font-weight: 700;
    }

    .subtitle{
      text-align:center;
      font-size: 14px;
      color: var(--muted);
      margin: 8px 0 18px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-weight: 700;
      font-size: 14px;
      margin: 12px 0 6px;
    }

    input[type="text"], select{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 14px;
      outline: none;
      background: #fff;
    }

    input[type="text"]:focus, select:focus{
      border-color: #cbd5e1;
      box-shadow: 0 0 0 3px rgba(59,130,246,.12);
    }

    .hint{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
    }

    .checkRow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top: 14px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fafafa;
    }

    .checkRow input{
      width: 16px;
      height: 16px;
      margin: 0;
    }

    .checkRow span{
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }

    .divider{
      height:1px;
      background: var(--border);
      margin: 18px 0;
    }

    button{
      width:100%;
      margin-top: 18px;
      padding: 13px 14px;
      border: none;
      border-radius: 12px;
      background: var(--btn);
      color: #fff;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
    }

    button:hover{ opacity: .92; }

    #result{
      margin-top: 16px;
      font-size: 15px;
      min-height: 44px;
    }

    .meta{
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
      min-height: 18px;
      word-break: break-word;
    }

    .cta{
      display:none;
      margin-top: 14px;
      gap: 10px;
      display:flex;
      flex-wrap: wrap;
    }

    .cta a{
      flex:1;
      min-width: 180px;
      text-align:center;
      padding: 12px 12px;
      border-radius: 12px;
      color:#fff;
      text-decoration:none;
      font-weight: 800;
    }

    .cta .call{ background: var(--success); }
    .cta .sms{ background: var(--btn); }
    .cta .email{ background: var(--blue); }

    .disclaimer{
      margin-top: 16px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    .error{ color:#dc2626; font-weight:700; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="container">

      <div class="header">
        <img class="logo" src="logo.png" alt="B-L Auto Export" onerror="this.style.display='none';" />
        <h1>Transport Cost Calculator <span class="badge">Broker estimate</span></h1>
      </div>

      <div class="subtitle">
        Local towing + nationwide auction/port transport. Final pricing confirmed before dispatch.
      </div>

      <div class="grid">
        <div>
          <label for="serviceType">Service type</label>
          <select id="serviceType">
            <option value="local">Local Tow (short distance)</option>
            <option value="transport" selected>Auction / Port Transport (nationwide)</option>
          </select>
          <div class="hint">Tip: Use “Transport” for auction → yard/port, long distance, dispatch jobs.</div>
        </div>

        <div>
          <label for="vehicleType">Vehicle type</label>
          <select id="vehicleType">
            <option value="sedan">Sedan/Compact</option>
            <option value="suv">SUV/Crossover</option>
            <option value="pickup">Pickup Truck</option>
            <option value="van">Van</option>
            <option value="oversize">Oversize/Heavy (manual quote)</option>
          </select>
          <div class="hint">Vehicle type affects estimate (larger vehicles cost more).</div>
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="shippingType">Shipping type</label>
          <select id="shippingType">
            <option value="open" selected>Open carrier</option>
            <option value="enclosed">Enclosed carrier</option>
          </select>
          <div class="hint">Enclosed is priced higher than open.</div>
        </div>

        <div>
          <label>&nbsp;</label>
          <div class="checkRow">
            <input id="portExport" type="checkbox" />
            <span>Port / Export handling (+$75)</span>
          </div>
          <div class="hint">Port/export add-on applies to transport jobs.</div>
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="vin">VIN (optional)</label>
          <input id="vin" type="text" placeholder="17-character VIN" maxlength="17" />
          <div id="vinInfo" class="meta"></div>
        </div>

        <div>
          <label>&nbsp;</label>
          <div class="checkRow">
            <input id="nonRunner" type="checkbox" />
            <span>Vehicle is a non-runner</span>
          </div>
          <div class="hint">Non-runner may require extra loading effort.</div>
        </div>
      </div>

      <div class="divider"></div>

      <label for="pickup">Pickup address</label>
      <input id="pickup" type="text" placeholder="e.g. Copart / IAAI address" />

      <label for="dropoff">Drop-off address</label>
      <input id="dropoff" type="text" placeholder="e.g. Shipping yard / Port (RoRo)" />

      <button id="calcBtn">Calculate Estimate</button>

      <div id="result"></div>

      <div id="cta" class="cta">
        <a class="call" href="tel:5083692955">Call Now</a>
        <a id="smsBtn" class="sms" href="sms:5083692955">Request Tow (Text)</a>
        <a id="emailBtn" class="email" href="mailto:info@blautoexport.com">Request Tow (Email)</a>
      </div>

      <div class="disclaimer">
        This is a non-binding estimate. Final price may vary based on carrier availability, vehicle condition, timing, access/wait time,
        and port requirements. We’ll confirm a final quote before dispatch.
      </div>
    </div>
  </div>

  <script>
    // =============================
    // GOOGLE ROUTES API KEY
    // =============================
    const GOOGLE_API_KEY = "AIzaSyBY26KUbAP6pSgGb3BBAVP15xjr_6EqFig";

    // =============================
    // PRICING SETTINGS
    // =============================
    const TRANS_MINIMUM = 200;
    const TRANS_PER_MILE = 1.50;
    const TRANS_NONRUNNER = 125;
    const PORT_EXPORT_FEE = 75;

    const TRANS_BROKER_FEE = 70;   // optional flat broker fee (after multipliers)
    const ROUND_TO = 25;           // rounds to nearest $25 for clean pricing

    const VEHICLE_MULTIPLIERS = {
      sedan: 1.00,
      suv: 1.15,
      pickup: 1.25,
      van: 1.20
    };

    const SHIPPING_MULTIPLIERS = {
      open: 1.00,
      enclosed: 1.60
    };

    // =============================
    // HELPERS
    // =============================
    function money(n){ return "$" + Number(n).toFixed(2); }
    function roundTo(amount){
      return Math.round(amount / ROUND_TO) * ROUND_TO;
    }

    // =============================
    // ROUTES API (distance)
    // =============================
    async function getDrivingDistanceMeters(origin, destination) {
      const res = await fetch("https://routes.googleapis.com/directions/v2:computeRoutes", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Goog-Api-Key": GOOGLE_API_KEY,
          "X-Goog-FieldMask": "routes.distanceMeters"
        },
        body: JSON.stringify({
          origin: { address: origin },
          destination: { address: destination },
          travelMode: "DRIVE"
        })
      });

      const text = await res.text();
      if (!res.ok) throw new Error(`Routes API failed (${res.status}): ${text}`);

      const data = JSON.parse(text);
      const meters = data?.routes?.[0]?.distanceMeters;
      if (!meters) throw new Error("No route distance returned.");
      return meters;
    }

    // =============================
    // VIN DECODER (NHTSA - free)
    // =============================
    function normalizeVin(vin){ return (vin || "").trim().toUpperCase(); }
    function isValidVinFormat(vin){ return /^[A-HJ-NPR-Z0-9]{17}$/.test(vin); }

    async function decodeVinNHTSA(vin) {
      const url = "https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVin/" + encodeURIComponent(vin) + "?format=json";
      const res = await fetch(url);
      if (!res.ok) throw new Error("VIN decode failed");
      const data = await res.json();

      const map = {};
      for (const item of (data.Results || [])) {
        if (item.Variable && item.Value) map[item.Variable] = item.Value;
      }

      const year = (map["Model Year"] || "").trim();
      const make = (map["Make"] || "").trim();
      const model = (map["Model"] || "").trim();
      const bodyClass = (map["Body Class"] || "").trim();
      const vehicleType = (map["Vehicle Type"] || "").trim();

      return {
        year, make, model, bodyClass, vehicleType,
        display: (year + " " + make + " " + model).trim()
      };
    }

    function suggestVehicleTypeFromVin(decoded) {
      const blob = ((decoded.bodyClass || "") + " " + (decoded.vehicleType || "")).toLowerCase();
      if (blob.includes("pickup")) return "pickup";
      if (blob.includes("van")) return "van";
      if (blob.includes("sport utility") || blob.includes("suv") || blob.includes("multipurpose")) return "suv";
      return "sedan";
    }

    // =============================
    // UI
    // =============================
    window.addEventListener("load", () => {
      const serviceTypeEl = document.getElementById("serviceType");
      const vehicleTypeEl = document.getElementById("vehicleType");
      const shippingTypeEl = document.getElementById("shippingType");

      const portExportEl = document.getElementById("portExport");
      const nonRunnerEl = document.getElementById("nonRunner");

      const vinEl = document.getElementById("vin");
      const vinInfoEl = document.getElementById("vinInfo");

      const pickupEl = document.getElementById("pickup");
      const dropoffEl = document.getElementById("dropoff");

      const resultDiv = document.getElementById("result");
      const cta = document.getElementById("cta");
      const smsBtn = document.getElementById("smsBtn");
      const emailBtn = document.getElementById("emailBtn");

      document.getElementById("calcBtn").addEventListener("click", async () => {
        cta.style.display = "none";
        resultDiv.classList.remove("error");
        vinInfoEl.textContent = "";

        const origin = pickupEl.value.trim();
        const destination = dropoffEl.value.trim();
        const serviceType = serviceTypeEl.value; // local | transport
        const shippingType = shippingTypeEl.value;
        const isNonRunner = nonRunnerEl.checked;
        const isPortExport = portExportEl.checked && (serviceType === "transport");

        if (!origin || !destination) {
          resultDiv.classList.add("error");
          resultDiv.textContent = "Please enter both pickup and drop-off addresses.";
          return;
        }

        if (vehicleTypeEl.value === "oversize") {
          resultDiv.classList.add("error");
          resultDiv.textContent = "Oversize/Heavy vehicles require a manual quote. Please call or text.";
          cta.style.display = "flex";
          return;
        }

        // VIN decode (optional)
        const vin = normalizeVin(vinEl.value);
        let vinDecoded = "";

        if (vin) {
          if (!isValidVinFormat(vin)) {
            resultDiv.classList.add("error");
            resultDiv.textContent = "VIN looks invalid (must be 17 chars; no I/O/Q).";
            return;
          }

          vinInfoEl.textContent = "Decoding VIN...";
          try {
            const meta = await decodeVinNHTSA(vin);
            vinDecoded = meta.display || "";
            vinInfoEl.textContent = vinDecoded ? ("VIN decoded: " + vinDecoded) : "VIN decoded (details unavailable).";
            vehicleTypeEl.value = suggestVehicleTypeFromVin(meta);
          } catch {
            vinInfoEl.textContent = "VIN decode failed (still calculating estimate).";
          }
        }

        resultDiv.textContent = "Calculating distance and estimate...";

        try {
          const meters = await getDrivingDistanceMeters(origin, destination);
          const miles = meters / 1609.34;

          const vehicleType = vehicleTypeEl.value;
          const vMult = VEHICLE_MULTIPLIERS[vehicleType] || 1.0;
          const sMult = SHIPPING_MULTIPLIERS[shippingType] || 1.0;

          let total;

          if (serviceType === "local") {
            // Simple local estimate (optional) – you can adjust later
            total = Math.max(125, miles * 4.5);
            if (isNonRunner) total += 50;
            total = total * vMult;
          } else {
            // Transport estimate
            const base =
              Math.max(TRANS_MINIMUM, miles * TRANS_PER_MILE) +
              (isNonRunner ? TRANS_NONRUNNER : 0) +
              (isPortExport ? PORT_EXPORT_FEE : 0);

            total = base * vMult * sMult;
            total += TRANS_BROKER_FEE;
          }

          total = roundTo(total);

          const estimateText = money(total);
          const distanceLine = miles.toFixed(1) + " miles";
          const serviceLabel = (serviceType === "local") ? "Local Tow" : "Auction/Port Transport";

          resultDiv.innerHTML =
            `<strong>Estimated cost: ${estimateText}</strong><br>` +
            `Distance: ${distanceLine}<br>` +
            `Service: ${serviceLabel}<br>` +
            `Vehicle type: ${vehicleTypeEl.options[vehicleTypeEl.selectedIndex].text}<br>` +
            `Shipping: ${(shippingType === "enclosed") ? "Enclosed" : "Open"}<br>` +
            (vin ? `VIN: ${vin}<br>` : "") +
            (vinDecoded ? `VIN decoded: ${vinDecoded}<br>` : "");

          cta.style.display = "flex";

          smsBtn.href =
            "sms:5083692955?&body=" +
            encodeURIComponent(
              "Hi B-L Auto Export, I'd like a quote/booking.\n" +
              "Service: " + serviceLabel + "\n" +
              "Vehicle: " + vehicleTypeEl.options[vehicleTypeEl.selectedIndex].text + "\n" +
              "Shipping: " + ((shippingType === "enclosed") ? "Enclosed" : "Open") + "\n" +
              (vin ? ("VIN: " + vin + "\n") : "") +
              (vinDecoded ? ("VIN decoded: " + vinDecoded + "\n") : "") +
              "Pickup: " + origin + "\n" +
              "Drop-off: " + destination + "\n" +
              "Distance: " + distanceLine + "\n" +
              "Estimated cost: " + estimateText
            );

          emailBtn.href =
            "mailto:info@blautoexport.com?subject=" +
            encodeURIComponent("Tow/Transport Request - B-L Auto Export") +
            "&body=" +
            encodeURIComponent(
              "Hello,\n\nI want to request a quote/booking.\n\n" +
              "Service: " + serviceLabel + "\n" +
              "Vehicle: " + vehicleTypeEl.options[vehicleTypeEl.selectedIndex].text + "\n" +
              "Shipping: " + ((shippingType === "enclosed") ? "Enclosed" : "Open") + "\n" +
              (vin ? ("VIN: " + vin + "\n") : "") +
              (vinDecoded ? ("VIN decoded: " + vinDecoded + "\n") : "") +
              "Pickup: " + origin + "\n" +
              "Drop-off: " + destination + "\n" +
              "Distance: " + distanceLine + "\n" +
              "Estimated cost: " + estimateText + "\n\n" +
              "Thanks"
            );

        } catch (err) {
          resultDiv.classList.add("error");
          resultDiv.textContent = "Unable to calculate distance. (" + err.message + ")";
        }
      });
    });
  </script>
</body>
</html>
