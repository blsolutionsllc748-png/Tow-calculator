<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transport Cost Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --brand-card:#ffffff;
      --brand-text:#111827;
      --brand-muted:#6b7280;
      --brand-accent-2:#0b1220;
      --brand-success:#16a34a;
      --brand-blue:#2563eb;
      --border:#e5e7eb;
      --bg:#f3f4f6;
    }

    body{font-family:Arial,sans-serif;background:var(--bg);margin:0;padding:0;}
    .container{max-width:820px;margin:40px auto;background:var(--brand-card);border-radius:14px;padding:24px;box-shadow:0 10px 25px rgba(0,0,0,.08);border:1px solid var(--border);}
    .header{display:flex;align-items:center;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:6px;}
    .logo{height:42px;width:auto;display:block;}
    h1{text-align:center;margin:0;font-size:24px;color:var(--brand-text);}
    .subtitle{text-align:center;font-size:14px;color:var(--brand-muted);margin:8px 0 18px;}

    label{font-weight:bold;font-size:14px;display:block;margin-top:12px;margin-bottom:6px;color:var(--brand-text);}
    input[type="text"], select{
      width:100%;padding:10px 10px;border-radius:10px;border:1px solid var(--border);
      font-size:14px;box-sizing:border-box;background:#fff;
    }
    .row{display:flex;gap:12px;flex-wrap:wrap;}
    .col{flex:1;min-width:240px;}

    .checkbox-row{display:flex;align-items:center;margin-top:12px;font-size:14px;color:var(--brand-text);gap:8px;}
    .checkbox-row input{transform:scale(1.05);}

    button{
      width:100%;margin-top:18px;padding:12px 0;background:var(--brand-accent-2);color:#fff;
      font-size:16px;font-weight:bold;border:none;border-radius:12px;cursor:pointer;
    }
    button:hover{opacity:.92;}

    #result{margin-top:16px;font-size:15px;min-height:44px;color:var(--brand-text);}
    .meta{margin-top:8px;font-size:13px;color:var(--brand-muted);min-height:18px;white-space:pre-wrap;word-break:break-word;}
    .hint{font-size:12px;color:var(--brand-muted);margin-top:6px;}
    .hr{height:1px;background:var(--border);margin:18px 0 6px;}

    .badge{
      display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;
      background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca;margin-left:6px;
    }

    .disclaimer{margin-top:16px;font-size:12px;color:var(--brand-muted);line-height:1.45;}

    .cta{display:none;margin-top:14px;gap:10px;display:flex;flex-wrap:wrap;}
    .cta a{
      flex:1;min-width:160px;text-align:center;padding:11px 12px;color:#fff;
      text-decoration:none;border-radius:12px;font-weight:bold;
    }
    .cta .call{background:var(--brand-success);}
    .cta .sms{background:var(--brand-accent-2);}
    .cta .email{background:var(--brand-blue);}
    .cta .book{background:#111827;}

    /* Admin panel */
    #adminPanel{
      display:none;margin-top:14px;border:1px solid var(--border);border-radius:12px;padding:12px;background:#fafafa;
    }
    .adminGrid{margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .adminGrid label{margin-top:0;}
    .adminGrid input[type="range"]{width:100%;}
    .adminTop{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
    .adminBtn{
      width:auto;padding:8px 12px;border-radius:10px;background:#111827;color:#fff;border:none;cursor:pointer;
    }
    .adminSmall{margin-top:10px;font-size:12px;color:var(--brand-muted);}
    .muted{opacity:.55;}
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <img class="logo" src="logo.png" alt="B-L Auto Export" onerror="this.style.display='none';" />
      <h1>Transport Cost Calculator <span class="badge">Broker estimate</span></h1>
    </div>

    <div class="subtitle">
      Local towing + nationwide auction/port transport. Final pricing confirmed before dispatch.
    </div>

    <div class="row">
      <div class="col">
        <label for="serviceType">Service type</label>
        <select id="serviceType">
          <option value="local">Local Tow (short distance)</option>
          <option value="transport" selected>Auction / Transport (nationwide)</option>
        </select>
        <div class="hint">Tip: Use “Transport” for auction → yard/port, long distance, Central Dispatch jobs.</div>
      </div>

      <div class="col">
        <label for="vehicleType">Vehicle type</label>
        <select id="vehicleType">
          <option value="sedan">Sedan/Compact</option>
          <option value="suv">SUV/Crossover</option>
          <option value="pickup">Pickup Truck</option>
          <option value="van">Van</option>
          <option value="oversize">Oversize/Heavy (manual quote)</option>
        </select>
        <div class="hint">Vehicle type affects estimate (larger vehicles cost more).</div>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label for="shippingType">Carrier type</label>
        <select id="shippingType">
          <option value="open" selected>Open carrier</option>
          <option value="enclosed">Enclosed carrier</option>
        </select>
        <div class="hint">Enclosed is priced higher than open.</div>
      </div>

      <div class="col">
        <label for="dropoffType">Drop-off type</label>
        <select id="dropoffType">
          <option value="yard" selected>Shipping yard / Warehouse</option>
          <option value="port">Port / RoRo terminal</option>
        </select>
        <div class="hint">Port/RoRo drop-offs typically cost more (gate, staging, scheduling).</div>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label for="vin">VIN (optional)</label>
        <input id="vin" type="text" placeholder="17-character VIN" maxlength="17" />
        <div id="vinInfo" class="meta"></div>
      </div>

      <div class="col">
        <label>&nbsp;</label>
        <div class="checkbox-row" style="margin-top:0;">
          <input id="nonRunner" type="checkbox" />
          <span>Vehicle is a non-runner</span>
        </div>
        <div class="hint">Non-runner may require winch/loading + extra time.</div>
      </div>
    </div>

    <div class="hr"></div>

    <label for="pickup">Pickup address</label>
    <input id="pickup" type="text" placeholder="e.g. Copart / IAAI address" />

    <label for="dropoff">Drop-off address</label>
    <input id="dropoff" type="text" placeholder="e.g. Shipping yard / Port (RoRo)" />

    <button id="calcBtn">Calculate Estimate</button>

    <div id="result"></div>

    <!-- Admin panel (only visible with ?admin=1) -->
    <div id="adminPanel">
      <div class="adminTop">
        <strong>Admin: Live Rate Tuning</strong>
        <button id="resetAdmin" class="adminBtn" type="button">Reset</button>
      </div>

      <div class="adminGrid">
        <div>
          <label>Short rate (0–150): <span id="v_rateShort"></span></label>
          <input id="rateShort" type="range" min="0.5" max="4.0" step="0.05">
        </div>
        <div>
          <label>Mid rate (151–600): <span id="v_rateMid"></span></label>
          <input id="rateMid" type="range" min="0.5" max="3.0" step="0.05">
        </div>
        <div>
          <label>Long rate (601+): <span id="v_rateLong"></span></label>
          <input id="rateLong" type="range" min="0.3" max="2.0" step="0.05">
        </div>
        <div>
          <label>Transport minimum: <span id="v_minimum"></span></label>
          <input id="minimum" type="range" min="0" max="800" step="10">
        </div>
        <div>
          <label>Dispatch fee: <span id="v_dispatchFee"></span></label>
          <input id="dispatchFee" type="range" min="0" max="250" step="5">
        </div>
        <div>
          <label>Deadhead buffer (miles): <span id="v_deadhead"></span></label>
          <input id="deadhead" type="range" min="0" max="50" step="1">
        </div>
        <div>
          <label>Port/RoRo fee: <span id="v_portFee"></span></label>
          <input id="portFee" type="range" min="0" max="300" step="5">
        </div>
        <div>
          <label>Non-runner fee optional: <span id="v_nonRunnerFee"></span></label>
          <input id="nonRunnerFee" type="range" min="0" max="400" step="5">
        </div>
        <div>
          <label>Round to ($): <span id="v_roundTo"></span></label>
          <input id="roundTo" type="range" min="1" max="100" step="1">
        </div>
        <div>
          <label>Enclosed multiplier: <span id="v_enclosedMult"></span></label>
          <input id="enclosedMult" type="range" min="1.1" max="2.5" step="0.05">
        </div>
        <div>
          <label>SUV multiplier: <span id="v_suvMult"></span></label>
          <input id="suvMult" type="range" min="1.0" max="1.4" step="0.01">
        </div>
        <div>
          <label>Pickup multiplier: <span id="v_pickupMult"></span></label>
          <input id="pickupMult" type="range" min="1.0" max="1.6" step="0.01">
        </div>
      </div>

      <div class="adminSmall">
        Admin sliders show only with <code>?admin=1</code>. Settings save in your browser (localStorage). Customers won’t see them.
      </div>
    </div>

    <div id="cta" class="cta">
      <a class="call" href="tel:5083692955">Call Now</a>
      <a id="smsBtn" class="sms" href="sms:5083692955">Request Tow (Text)</a>
      <a id="emailBtn" class="email" href="mailto:info@blautoexport.com">Request Tow (Email)</a>
      <a id="bookBtn" class="book" href="#" target="_blank" rel="noopener">Book RoRo / Container</a>
    </div>

    <div class="disclaimer">
      This is a non-binding estimate. Final price may vary based on carrier availability, vehicle condition, timing, access/wait time,
      and port requirements. We’ll confirm a final quote before dispatch.
    </div>
  </div>

  <script>
    // =========================
    // PUT YOUR ROUTES API KEY HERE
    // =========================
    const GOOGLE_API_KEY = "AIzaSyBY26KUbAP6pSgGb3BBAVP15xjr_6EqFig";

    // Booking Form (Google Forms public link)
    const BOOKING_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdywvgOLKM5mMyZdEucaJLwoLt_G4l_Z0OLD0HE4IAhtok6mQ/viewform?usp=pp_url&entry.1993602587=Container&entry.270647829=Test+User&entry.1564808048=1234567890&entry.2070516419=test@test.com&entry.1572651423=Ghana&entry.1933990655=Baltimore,+MD&entry.1135344178=Tema&entry.666103640=2018+Toyota+Camry&entry.1074558705=1HGCM82633A004352&entry.1454334897=Run+and+drive&entry.264996793=Copart+Baltimore&entry.886940307=Option+1&entry.380278386=20ft&entry.848469704=Vehicle+only&entry.1330101939=Test+goods&entry.1162964605=Test+submission";

    // Show admin UI only if ?admin=1
    const IS_ADMIN = new URLSearchParams(window.location.search).get("admin") === "1";

    // =========================
    // DEFAULT SETTINGS (admin sliders control these)
    // =========================
    const ADMIN_KEY = "bl_admin_rates_v2";

    const DEFAULTS = {
      // Transport tier rates (per mile)
      rateShort: 2.10,   // 0-150
      rateMid:   1.15,   // 151-600
      rateLong:  0.55,   // 601+

      minimum: 250,
      dispatchFee: 75,
      deadhead: 10,
      portFee: 100,
      nonRunnerFee: 125,

      roundTo: 25,

      enclosedMult: 1.60,
      suvMult: 1.08,
      pickupMult: 1.20
    };

    function loadAdmin() {
      try {
        const raw = localStorage.getItem(ADMIN_KEY);
        if (!raw) return { ...DEFAULTS };
        const parsed = JSON.parse(raw);
        return { ...DEFAULTS, ...parsed };
      } catch {
        return { ...DEFAULTS };
      }
    }
    function saveAdmin(s) { localStorage.setItem(ADMIN_KEY, JSON.stringify(s)); }

    let ADMIN = loadAdmin();

    // =========================
    // HELPERS
    // =========================
    function money(n){ return "$" + Number(n).toFixed(2); }

    function roundPrice(amount){
      const r = Math.max(1, Number(ADMIN.roundTo || 1));
      return Math.round(amount / r) * r;
    }

    function vehicleLabel(v){
      return ({sedan:"Sedan/Compact",suv:"SUV/Crossover",pickup:"Pickup Truck",van:"Van",oversize:"Oversize/Heavy (manual quote)"})[v] || v;
    }
    function shippingLabel(s){ return s === "enclosed" ? "Enclosed" : "Open"; }
    function dropoffLabel(t){ return t === "port" ? "Port / RoRo terminal" : "Shipping yard / Warehouse"; }

    function normalizeVin(vin){ return (vin || "").trim().toUpperCase(); }
    function isValidVinFormat(vin){ return /^[A-HJ-NPR-Z0-9]{17}$/.test(vin); }

    async function decodeVinNHTSA(vin){
      const url = "https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVin/" + encodeURIComponent(vin) + "?format=json";
      const res = await fetch(url);
      if(!res.ok) throw new Error("VIN decode failed");
      const data = await res.json();

      const map = {};
      for(const item of (data.Results || [])){
        if(item.Variable && item.Value) map[item.Variable] = item.Value;
      }

      const year = (map["Model Year"] || "").trim();
      const make = (map["Make"] || "").trim();
      const model = (map["Model"] || "").trim();
      const bodyClass = (map["Body Class"] || "").trim();
      const vehicleType = (map["Vehicle Type"] || "").trim();

      return {
        year, make, model, bodyClass, vehicleType,
        display: (year + " " + make + " " + model).trim()
      };
    }

    function suggestVehicleTypeFromVin(decoded){
      const blob = ((decoded.bodyClass || "") + " " + (decoded.vehicleType || "")).toLowerCase();
      if(blob.includes("pickup")) return "pickup";
      if(blob.includes("van")) return "van";
      if(blob.includes("sport utility") || blob.includes("suv") || blob.includes("multipurpose")) return "suv";
      return "sedan";
    }

    async function getDrivingDistanceMeters(origin, destination){
      const res = await fetch("https://routes.googleapis.com/directions/v2:computeRoutes", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Goog-Api-Key": GOOGLE_API_KEY,
          "X-Goog-FieldMask": "routes.distanceMeters"
        },
        body: JSON.stringify({
          origin: { address: origin },
          destination: { address: destination },
          travelMode: "DRIVE"
        })
      });

      const text = await res.text();
      if(!res.ok) throw new Error(`Routes API failed (${res.status}): ${text}`);
      const data = JSON.parse(text);
      const meters = data?.routes?.[0]?.distanceMeters;
      if(!meters) throw new Error("No route distance returned.");
      return meters;
    }

    // Tiered transport cost (miles already includes deadhead)
    function tieredTransportCost(miles){
      const m = Math.max(0, miles);
      const a = Math.min(m, 150);
      const b = Math.min(Math.max(m - 150, 0), 450); // 151-600
      const c = Math.max(m - 600, 0);

      const cost =
        a * Number(ADMIN.rateShort) +
        b * Number(ADMIN.rateMid) +
        c * Number(ADMIN.rateLong);

      return Math.max(Number(ADMIN.minimum), cost);
    }

    // Multipliers for vehicle + carrier
    function getVehicleMultiplier(vehicleType){
      if(vehicleType === "suv") return Number(ADMIN.suvMult);
      if(vehicleType === "pickup") return Number(ADMIN.pickupMult);
      if(vehicleType === "van") return 1.15;
      return 1.00;
    }
    function getCarrierMultiplier(shippingType){
      if(shippingType === "enclosed") return Number(ADMIN.enclosedMult);
      return 1.00;
    }

    // =========================
    // ADMIN PANEL UI
    // =========================
    function initAdminPanel(){
      const panel = document.getElementById("adminPanel");
      if(!panel) return;
      if(!IS_ADMIN) return;

      panel.style.display = "block";

      const bind = (id, key, fmt) => {
        const el = document.getElementById(id);
        const out = document.getElementById("v_" + id);
        el.value = ADMIN[key];
        out.textContent = fmt ? fmt(ADMIN[key]) : ADMIN[key];

        el.addEventListener("input", () => {
          ADMIN[key] = Number(el.value);
          out.textContent = fmt ? fmt(ADMIN[key]) : ADMIN[key];
          saveAdmin(ADMIN);
        });
      };

      bind("rateShort", "rateShort", v => "$" + v.toFixed(2) + "/mi");
      bind("rateMid", "rateMid", v => "$" + v.toFixed(2) + "/mi");
      bind("rateLong", "rateLong", v => "$" + v.toFixed(2) + "/mi");
      bind("minimum", "minimum", v => "$" + v.toFixed(0));
      bind("dispatchFee", "dispatchFee", v => "$" + v.toFixed(0));
      bind("deadhead", "deadhead", v => v.toFixed(0) + " mi");
      bind("portFee", "portFee", v => "$" + v.toFixed(0));
      bind("nonRunnerFee", "nonRunnerFee", v => "$" + v.toFixed(0));
      bind("roundTo", "roundTo", v => "$" + v.toFixed(0));
      bind("enclosedMult", "enclosedMult", v => "x" + v.toFixed(2));
      bind("suvMult", "suvMult", v => "x" + v.toFixed(2));
      bind("pickupMult", "pickupMult", v => "x" + v.toFixed(2));

      document.getElementById("resetAdmin").addEventListener("click", () => {
        ADMIN = { ...DEFAULTS };
        saveAdmin(ADMIN);
        location.reload();
      });
    }

    // =========================
    // MAIN UI LOGIC
    // =========================
    window.addEventListener("load", () => {
      initAdminPanel();

      const btn = document.getElementById("calcBtn");
      const serviceTypeEl = document.getElementById("serviceType");
      const vehicleTypeEl = document.getElementById("vehicleType");
      const shippingTypeEl = document.getElementById("shippingType");
      const dropoffTypeEl = document.getElementById("dropoffType");

      const vinEl = document.getElementById("vin");
      const vinInfoEl = document.getElementById("vinInfo");
      const pickupInput = document.getElementById("pickup");
      const dropoffInput = document.getElementById("dropoff");

      const nonRunnerEl = document.getElementById("nonRunner");

      const resultDiv = document.getElementById("result");
      const cta = document.getElementById("cta");
      const smsBtn = document.getElementById("smsBtn");
      const emailBtn = document.getElementById("emailBtn");
      const bookBtn = document.getElementById("bookBtn");

      // Always show booking button after calc, link to form
      bookBtn.href = BOOKING_FORM_URL;

      btn.addEventListener("click", async () => {
        cta.style.display = "none";
        resultDiv.style.color = "#111827";
        vinInfoEl.textContent = "";

        const origin = (pickupInput.value || "").trim();
        const destination = (dropoffInput.value || "").trim();

        const serviceType = serviceTypeEl.value;     // local|transport
        const vehicleType = vehicleTypeEl.value;
        const shippingType = shippingTypeEl.value;
        const dropoffType = dropoffTypeEl.value;     // yard|port
        const isNonRunner = nonRunnerEl.checked;

        if(!origin || !destination){
          resultDiv.style.color = "red";
          resultDiv.textContent = "Please enter both pickup and drop-off addresses.";
          return;
        }

        if(vehicleType === "oversize"){
          resultDiv.style.color = "red";
          resultDiv.textContent = "Oversize/Heavy vehicles require a manual quote. Please call or text.";
          cta.style.display = "flex";
          return;
        }

        // VIN decode (optional)
        const vin = normalizeVin(vinEl.value);
        let vinDecoded = "";
        if(vin){
          if(!isValidVinFormat(vin)){
            resultDiv.style.color = "red";
            resultDiv.textContent = "VIN looks invalid (must be 17 chars; no I/O/Q). Please check and try again.";
            return;
          }
          vinInfoEl.textContent = "Decoding VIN...";
          try{
            const meta = await decodeVinNHTSA(vin);
            vinDecoded = meta.display || "";
            vinInfoEl.textContent = vinDecoded ? ("VIN decoded: " + vinDecoded) : "VIN decoded (details unavailable).";
            vehicleTypeEl.value = suggestVehicleTypeFromVin(meta);
          }catch{
            vinInfoEl.textContent = "VIN decode failed (still calculating estimate).";
          }
        }

        resultDiv.textContent = "Calculating distance and estimate...";

        try{
          const meters = await getDrivingDistanceMeters(origin, destination);
          const milesRaw = meters / 1609.34;
          const miles = milesRaw + Number(ADMIN.deadhead); // deadhead buffer

          const vMult = getVehicleMultiplier(vehicleTypeEl.value);
          const cMult = getCarrierMultiplier(shippingType);

          let total = 0;

          if(serviceType === "local"){
            // Simple local model: flat up to 10mi + per mile after (editable here if you want sliders too)
            const LOCAL_FLAT_UP_TO_10MI = 125;
            const LOCAL_PER_MILE_AFTER_10 = 4.50;
            const LOCAL_NONRUNNER = 50;

            const baseLocal = (milesRaw <= 10)
              ? LOCAL_FLAT_UP_TO_10MI
              : (LOCAL_FLAT_UP_TO_10MI + ((milesRaw - 10) * LOCAL_PER_MILE_AFTER_10));

            total = baseLocal + (isNonRunner ? LOCAL_NONRUNNER : 0);
            total = total * vMult;
            total = roundPrice(total);
          } else {
            // Transport
            let base = tieredTransportCost(miles);
            base += Number(ADMIN.dispatchFee);

            // Port/RoRo fee only if dropoff type = port
            if(dropoffType === "port") base += Number(ADMIN.portFee);

            // Non-runner add-on
            if(isNonRunner) base += Number(ADMIN.nonRunnerFee);

            // Apply multipliers
            total = base * vMult * cMult;
            total = roundPrice(total);
          }

          const serviceLabel = (serviceType === "local") ? "Local Tow" : "Auction/Port Transport";
          const distanceLine = milesRaw.toFixed(1) + " miles";
          const vehicleText = vehicleLabel(vehicleTypeEl.value);
          const carrierText = shippingLabel(shippingType);
          const dropoffText = dropoffLabel(dropoffType);
          const estimateText = money(total);

          // Customer output (no formula)
          resultDiv.style.color = "#111827";
          resultDiv.innerHTML =
            "<strong>Estimated cost: " + estimateText + "</strong><br>" +
            "Distance: " + distanceLine + "<br>" +
            "Service: " + serviceLabel + "<br>" +
            "Vehicle type: " + vehicleText + "<br>" +
            "Carrier: " + carrierText + "<br>" +
            (serviceType === "transport" ? ("Drop-off type: " + dropoffText + "<br>") : "") +
            (vin ? ("VIN: " + vin + "<br>") : "") +
            (vinDecoded ? ("VIN decoded: " + vinDecoded + "<br>") : "");

          cta.style.display = "flex";

          // Prefill messages
          const nonRunnerText = isNonRunner ? "Yes" : "No";

          smsBtn.href =
            "sms:5083692955?&body=" +
            encodeURIComponent(
              "Hi B-L Auto Export, I'd like a quote/booking.\n" +
              "Service: " + serviceLabel + "\n" +
              "Vehicle: " + vehicleText + "\n" +
              "Carrier: " + carrierText + "\n" +
              (serviceType === "transport" ? ("Drop-off type: " + dropoffText + "\n") : "") +
              (vin ? ("VIN: " + vin + "\n") : "") +
              (vinDecoded ? ("VIN decoded: " + vinDecoded + "\n") : "") +
              "Pickup: " + origin + "\n" +
              "Drop-off: " + destination + "\n" +
              "Distance: " + distanceLine + "\n" +
              "Non-runner: " + nonRunnerText + "\n" +
              "Estimated: " + estimateText
            );

          emailBtn.href =
            "mailto:info@blautoexport.com?subject=" +
            encodeURIComponent("Tow/Transport Request - B-L Auto Export") +
            "&body=" +
            encodeURIComponent(
              "Hello,\n\nI want to request a quote/booking.\n\n" +
              "Service: " + serviceLabel + "\n" +
              "Vehicle: " + vehicleText + "\n" +
              "Carrier: " + carrierText + "\n" +
              (serviceType === "transport" ? ("Drop-off type: " + dropoffText + "\n") : "") +
              (vin ? ("VIN: " + vin + "\n") : "") +
              (vinDecoded ? ("VIN decoded: " + vinDecoded + "\n") : "") +
              "Pickup: " + origin + "\n" +
              "Drop-off: " + destination + "\n" +
              "Distance: " + distanceLine + "\n" +
              "Non-runner: " + nonRunnerText + "\n" +
              "Estimated: " + estimateText + "\n\n" +
              "Thanks"
            );

          // Admin-only breakdown appended (optional)
          if(IS_ADMIN){
            resultDiv.innerHTML +=
              "<hr style='margin:10px 0;border:none;border-top:1px solid #e5e7eb;'>" +
              "<strong>Admin notes</strong><br>" +
              "Deadhead buffer used: " + Number(ADMIN.deadhead).toFixed(0) + " mi<br>" +
              "Vehicle mult: x" + vMult.toFixed(2) + "<br>" +
              "Carrier mult: x" + cMult.toFixed(2) + "<br>" +
              "Tier rates: " + money(ADMIN.rateShort) + "/mi, " + money(ADMIN.rateMid) + "/mi, " + money(ADMIN.rateLong) + "/mi<br>" +
              "Min: " + money(ADMIN.minimum) + " • Dispatch: " + money(ADMIN.dispatchFee) +
              " • Port fee: " + money(ADMIN.portFee) + " • Non-runner: " + money(ADMIN.nonRunnerFee);
          }

        }catch(err){
          resultDiv.style.color = "red";
          resultDiv.textContent = "Unable to calculate distance. (" + err.message + ")";
        }
      });
    });
  </script>
</body>
</html>
